---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurus æ’ä»¶æ·»åŠ  PWA æ”¯æŒä½¿ç”¨[Workbox](https://developers.google.com/web/tools/workbox)ã€‚è¿™ä¸ªæ’ä»¶åªåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”Ÿæˆä¸€ä¸ª [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œå¹¶å…è®¸ä½ åˆ›å»ºå®Œå…¨ç¬¦åˆ pwa çš„æ–‡æ¡£ç«™ç‚¹ï¼Œæ”¯æŒç¦»çº¿å’Œå®‰è£…ã€‚

## å®‰è£… {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åˆ›å»ºä¸€ä¸ª[PWA æ¸…å•](https://web.dev/add-manifest/)åœ¨`./static/manifest.json`ã€‚

ä½¿ç”¨æœ€å°çš„ PWA é…ç½®ä¿®æ”¹`docusaurus.config.js`ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js title="docusaurus.config.js"
module.exports = {
  plugins: [
    [
      "@docusaurus/plugin-pwa",
      {
        debug: true,
        offlineModeActivationStrategies: ["appInstalled", "standalone", "queryString"],
        pwaHead: [
          {
            tagName: "link",
            rel: "icon",
            href: "/img/docusaurus.png",
          },
          {
            tagName: "link",
            rel: "manifest",
            href: "/manifest.json", // your PWA manifest
          },
          {
            tagName: "meta",
            name: "theme-color",
            content: "rgb(37, 194, 160)",
          },
        ],
      },
    ],
  ],
};
```

## æ¸è¿›å¼ Web åº”ç”¨ {#progressive-web-app}

å®‰è£… service worker å¹¶ä¸è¶³ä»¥ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºæˆä¸º PWAã€‚ä½ éœ€è¦è‡³å°‘åŒ…æ‹¬ä¸€ä¸ª[Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)ï¼Œå¹¶åœ¨`<head>` ([Options > pwaHead](#pwaHead))ä¸­æœ‰æ­£ç¡®çš„æ ‡ç­¾ã€‚

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[Lighthouse](https://developers.google.com/web/tools/lighthouse)åœ¨ç«™ç‚¹ä¸Šè¿è¡Œå®¡è®¡ã€‚

æœ‰å…³æ‚¨çš„ç«™ç‚¹æˆä¸º PWA æ‰€éœ€æ¡ä»¶çš„æ›´è¯¦å°½çš„åˆ—è¡¨ï¼Œè¯·å‚é˜…[PWA Checklist](https://developers.google.com/web/progressive-web-apps/checklist)ã€‚

## åº”ç”¨å®‰è£…æ”¯æŒ {#app-installation-support}

å¦‚æœä½ çš„æµè§ˆå™¨æ”¯æŒå®ƒï¼Œä½ åº”è¯¥èƒ½å¤Ÿå°† Docusaurus ç«™ç‚¹ä½œä¸ºåº”ç”¨ç¨‹åºå®‰è£…ã€‚

![å®‰è£…è¿‡ç¨‹çš„å±å¹•è®°å½•ã€‚æµè§ˆå™¨çš„åœ°å€æ ä¸­ä¼šå‡ºç°ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åä¼šæ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯¢é—®`å®‰è£…æ­¤åº”ç”¨ç¨‹åº?`ç‚¹å‡»`å®‰è£…`æŒ‰é’®åï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­æ‰“å¼€ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œæ‰“å¼€Docusaurusä¸»é¡µã€‚](/img/pwa_install.gif)

:::note

åº”ç”¨ç¨‹åºå®‰è£…éœ€è¦ HTTPS åè®®å’Œæœ‰æ•ˆçš„æ¸…å•ã€‚

:::

## ç¦»çº¿æ¨¡å¼ (precaching) {#offline-mode-precaching}

æˆ‘ä»¬å…è®¸ç”¨æˆ·ç¦»çº¿æµè§ˆ Docusaurus ç½‘ç«™ï¼Œé€šè¿‡ä½¿ç”¨ service-worker è¯´æ•™ã€‚

[workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching)é¡µé¢è§£é‡Šäº†è¿™ä¸ªæƒ³æ³•:

> service worker çš„ä¸€ä¸ªç‰¹æ€§æ˜¯èƒ½å¤Ÿåœ¨ service worker å®‰è£…æ—¶å°†ä¸€ç»„æ–‡ä»¶ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚è¿™é€šå¸¸è¢«ç§°ä¸º`è¯´æ•™`ï¼Œå› ä¸ºä½ åœ¨ä½¿ç”¨ service worker ä¹‹å‰ç¼“å­˜å†…å®¹ã€‚
>
> è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯ï¼Œå®ƒä½¿å¼€å‘äººå‘˜å¯ä»¥æ§åˆ¶ç¼“å­˜ï¼Œè¿™æ„å‘³ç€ä»–ä»¬å¯ä»¥å†³å®šä½•æ—¶å’Œå¤šé•¿æ—¶é—´çš„æ–‡ä»¶ç¼“å­˜ï¼Œå¹¶æä¾›ç»™æµè§ˆå™¨ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç½‘ç»œï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºç¦»çº¿å·¥ä½œçš„ web åº”ç”¨ç¨‹åºã€‚
>
> Workbox é€šè¿‡ç®€åŒ– API å’Œç¡®ä¿èµ„æºè¢«é«˜æ•ˆä¸‹è½½ï¼Œçœå»äº†å¤§é‡ç¹é‡çš„è¯´æ•™å·¥ä½œã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç«™ç‚¹ä½œä¸ºåº”ç”¨ç¨‹åºå®‰è£…æ—¶ï¼Œç¦»çº¿æ¨¡å¼æ˜¯å¯ç”¨çš„ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è§`offlineModeActivationStrategies`é€‰é¡¹ã€‚

åœ¨ç«™ç‚¹è¢«é¢„ä¼ ä¹‹åï¼Œservice worker å°†ä¸ºä»¥åçš„è®¿é—®æä¾›ç¼“å­˜çš„å“åº”ã€‚å½“æ–°çš„æ„å»ºä¸æ–°çš„ service worker ä¸€èµ·éƒ¨ç½²æ—¶ï¼Œæ–°çš„ service worker å°†å¼€å§‹å®‰è£…ï¼Œå¹¶æœ€ç»ˆè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åœ¨æ­¤ç­‰å¾…çŠ¶æ€ä¸­ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªé‡æ–°åŠ è½½å¼¹å‡ºçª—å£ï¼Œå¹¶è¦æ±‚ç”¨æˆ·é‡æ–°åŠ è½½é¡µé¢ä»¥è·å–æ–°å†…å®¹ã€‚ç›´åˆ°ç”¨æˆ·æ¸…ç©ºäº†åº”ç”¨ç¼“å­˜æˆ–è€…ç‚¹å‡»äº†å¼¹å‡ºçª—å£ä¸Šçš„`é‡æ–°åŠ è½½`æŒ‰é’®ï¼Œservice worker æ‰ä¼šç»§ç»­æä¾›æ—§çš„å†…å®¹ã€‚

:::caution

ç¦»çº¿æ¨¡å¼/é¢„ä¼ éœ€è¦æå‰ä¸‹è½½ç«™ç‚¹çš„æ‰€æœ‰é™æ€èµ„äº§ï¼Œå¹¶ä¸”ä¼šæ¶ˆè€—ä¸å¿…è¦çš„å¸¦å®½ã€‚å¯¹æ‰€æœ‰ç±»å‹çš„ç«™ç‚¹éƒ½æ¿€æ´»å®ƒå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚

:::

## é€‰é¡¹ {#options}

### `debug` {#debug}

- Type: `boolean`
- Default: `false`

æ‰“å¼€è°ƒè¯•æ¨¡å¼:

- Workbox logs
- Additional Docusaurus logs
- Unoptimized SW file output
- Source maps

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- Type: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- Default: `['appInstalled', 'queryString', 'standalone']`

å¼€å¯ç¦»çº¿æ¨¡å¼çš„ç­–ç•¥:

- `appInstalled`: æ¿€æ´»ç”¨æˆ·å·²å®‰è£…çš„ç½‘ç«™ä½œä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åº(ä¸æ˜¯ 100%å¯é )
- `standalone`: ä¸ºç‹¬ç«‹è¿è¡Œåº”ç”¨ç¨‹åºçš„ç”¨æˆ·æ¿€æ´»(é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€æ—¦å®‰è£…äº† PWA)
- `queryString`: å¦‚æœ queryString åŒ…å«`offlineMode=true`åˆ™æ¿€æ´»(æ–¹ä¾¿ PWA è°ƒè¯•)
- `mobile`: ç§»åŠ¨ç”¨æˆ·æ¿€æ´» (`width <= 996px`)
- `saveData`: ä½¿ç”¨`navigator.connection.saveData === true`æ¿€æ´»ç”¨æˆ·
- `always`: å¯¹æ‰€æœ‰ç”¨æˆ·æ¿€æ´»

:::caution

è¯·è°¨æ…ä½¿ç”¨:æœ‰äº›ç”¨æˆ·å¯èƒ½ä¸å–œæ¬¢è¢«è¿«ä½¿ç”¨ç¦»çº¿æ¨¡å¼ã€‚

:::

:::danger

æ— æ³•æ£€æµ‹é¡µé¢æ˜¯å¦ä»¥å¯é çš„æ–¹å¼å‘ˆç°ä¸º PWAã€‚

`appinstalled`äº‹ä»¶å·²[ä»è§„èŒƒä¸­åˆ é™¤](https://github.com/w3c/manifest/pull/836)ï¼Œè€Œ[`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) API ä»…æ”¯æŒæœ€è¿‘çš„ Chrome ç‰ˆæœ¬ï¼Œå¹¶ä¸”éœ€è¦åœ¨ manifest ä¸­å£°æ˜`related_applications`ã€‚

['ç‹¬ç«‹'ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åå¤‡æ¿€æ´»ç¦»çº¿æ¨¡å¼(è‡³å°‘åœ¨è¿è¡Œå·²å®‰è£…çš„åº”ç”¨ç¨‹åºæ—¶)ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

[Workbox options](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ä¼ é€’ç»™`Workbox.injectmanifest()`ã€‚è¿™ä½¿æ‚¨å¯ä»¥æ§åˆ¶å“ªäº›èµ„äº§å°†è¢«é¢„ä¼ ï¼Œå“ªäº›èµ„äº§å¯ä»¥ç¦»çº¿ä½¿ç”¨ã€‚

- Type: `InjectManifestOptions`
- Default: `{}`

```js title="docusaurus.config.js"
module.exports = {
  plugins: [
    [
      "@docusaurus/plugin-pwa",
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ["**/*.{pdf,docx,xlsx}"],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- Type: `({ tagName: string; [attributeName: string]: string })[]`
- Default: `[]`

åŒ…å«`tagName`å’Œç”¨äºæ³¨å…¥`<head>`æ ‡ç­¾çš„å±æ€§çš„é”®å€¼å¯¹çš„å¯¹è±¡æ•°ç»„ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œæ‚¨å¯ä»¥é€šè¿‡å®ƒæ³¨å…¥ä»»ä½•å¤´éƒ¨æ ‡ç­¾ï¼Œä½†å®ƒæœ€é€‚åˆç”¨äºä½¿æ‚¨çš„ç«™ç‚¹ç¬¦åˆ PWA çš„æ ‡ç­¾ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ ‡ç­¾åˆ—è¡¨ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºå®Œå…¨å…¼å®¹:

```js
module.exports = {
  plugins: [
    [
      "@docusaurus/plugin-pwa",
      {
        pwaHead: [
          {
            tagName: "link",
            rel: "icon",
            href: "/img/docusaurus.png",
          },
          {
            tagName: "link",
            rel: "manifest",
            href: "/manifest.json",
          },
          {
            tagName: "meta",
            name: "theme-color",
            content: "rgb(37, 194, 160)",
          },
          {
            tagName: "meta",
            name: "apple-mobile-web-app-capable",
            content: "yes",
          },
          {
            tagName: "meta",
            name: "apple-mobile-web-app-status-bar-style",
            content: "#000",
          },
          {
            tagName: "link",
            rel: "apple-touch-icon",
            href: "/img/docusaurus.png",
          },
          {
            tagName: "link",
            rel: "mask-icon",
            href: "/img/docusaurus.svg",
            color: "rgb(37, 194, 160)",
          },
          {
            tagName: "meta",
            name: "msapplication-TileImage",
            content: "/img/docusaurus.png",
          },
          {
            tagName: "meta",
            name: "msapplication-TileColor",
            content: "#000",
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- Type: `string | undefined`
- Default: `undefined`

ç”¨äºå…¶ä»–å·¥ä½œæ¡†è§„åˆ™ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥åš service worker èƒ½åšçš„ä»»ä½•äº‹æƒ…ï¼Œå¹¶å……åˆ†åˆ©ç”¨å·¥ä½œç›’åº“çš„å¼ºå¤§åŠŸèƒ½ã€‚ä»£ç æ˜¯ç»è¿‡ç¼–è¯‘çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ç°ä»£ ES6+è¯­æ³•ã€‚

ä¾‹å¦‚ï¼Œè¦ä»å¤–éƒ¨è·¯ç”±ç¼“å­˜æ–‡ä»¶:

```js
import { registerRoute } from "workbox-routing";
import { StaleWhileRevalidate } from "workbox-strategies";

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [/graph\.facebook\.com\/.*\/picture/, /netlify\.com\/img/, /avatars1\.githubusercontent/].some((regex) =>
      context.url.href.match(regex)
    );
  }, new StaleWhileRevalidate());
}
```

è¯¥æ¨¡å—åº”è¯¥æœ‰ä¸€ä¸ª`default`å‡½æ•°å¯¼å‡ºï¼Œå¹¶æ¥æ”¶ä¸€äº›å‚æ•°ã€‚

### `swRegister` {#swregister}

- Type: `string | false`
- Default: `'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨ Docusaurus åº”ç”¨ç¨‹åºä¹‹å‰æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºè¿è¡Œä¹‹å‰è¿›è¡Œæ³¨å†Œã€‚é»˜è®¤çš„`registerSW.js`æ–‡ä»¶è¶³ä»¥è¿›è¡Œç®€å•çš„æ³¨å†Œã€‚

ä¼ é€’`false`å°†å®Œå…¨ç¦ç”¨æ³¨å†Œã€‚

## Manifest ä¾‹å­ {#manifest-example}

Docusaurus é—å€æ¸…å•å¯ä»¥ä½œä¸ºä¸€ç§çµæ„Ÿ:

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require("@site/static/manifest.json"),null,2)}
</CodeBlock>
```

## è‡ªå®šä¹‰é‡æ–°åŠ è½½å¼¹å‡º {#customizing-reload-popup}

`@theme/PwaReloadPopup`ç»„ä»¶æ˜¯åœ¨ä¸€ä¸ªæ–°çš„ service worker ç­‰å¾…å®‰è£…æ—¶å‘ˆç°çš„ï¼Œæˆ‘ä»¬å»ºè®®é‡æ–°åŠ è½½ç»™ç”¨æˆ·ã€‚ä½ å¯ä»¥[swizzle](../../swizzling.mdx)è¿™ä¸ªç»„ä»¶å¹¶å®ç°ä½ è‡ªå·±çš„ UIã€‚å®ƒå°†æ¥æ”¶ä¸€ä¸ª`onReload`å›è°ƒä½œä¸ºå±æ€§ï¼Œå®ƒåº”è¯¥åœ¨`reload`æŒ‰é’®è¢«ç‚¹å‡»æ—¶è¢«è°ƒç”¨ã€‚è¿™å°†å‘Šè¯‰ service worker å®‰è£…ç­‰å¾…çš„ service worker å¹¶é‡æ–°åŠ è½½é¡µé¢ã€‚

é»˜è®¤ä¸»é¢˜åŒ…æ‹¬é‡è½½å¼¹å‡ºçª—å£çš„å®ç°ï¼Œå¹¶ä½¿ç”¨[Infima Alerts](https://infima.dev/docs/components/alert)ã€‚

![é‡è£…è¿‡ç¨‹çš„å±å¹•è®°å½•ã€‚çª—å£çš„å³ä¸‹è§’ä¼šæ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šæ¡†ï¼Œæç¤º`æ–°å†…å®¹å¯ç”¨`ã€‚ç‚¹å‡»`åˆ·æ–°`æŒ‰é’®åï¼Œé¡µé¢ä¸»æ ‡é¢˜ç”±`ç®€ä»‹`å˜ä¸º`PWA:)`ã€‚](/img/pwa_reload.gif)

æ‚¨çš„ç»„ä»¶å¯ä»¥å‘ˆç°`null`ï¼Œä½†ä¸å»ºè®®è¿™æ ·åš:ç”¨æˆ·å°†æ— æ³•è·å¾—æœ€æ–°çš„å†…å®¹ã€‚
