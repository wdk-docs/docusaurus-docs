"use strict";(self.webpackChunkdocusaurus_docs=self.webpackChunkdocusaurus_docs||[]).push([[3545],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},18679:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(67294),a=n(86010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,i),hidden:n},t)}},73992:(e,t,n)=>{n.d(t,{Z:()=>w});var r=n(87462),a=n(67294),o=n(86010),i=n(72957),s=n(16550),l=n(75238),u=n(33609),c=n(92560);function p(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function d(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:n}=e;const r=(0,s.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function h(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=d(e),[i,s]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[l,u]=f({queryString:n,groupId:r}),[p,h]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,c.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:r}),k=(()=>{const e=l??p;return m({value:e,tabValues:o})?e:null})();(0,a.useLayoutEffect)((()=>{k&&s(k)}),[k]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),h(e)}),[u,h,o]),tabValues:o}}var k=n(51048);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:n,selectedValue:s,selectValue:l,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),r=u[n].value;r!==s&&(p(t),l(r))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},i,{className:(0,o.Z)("tabs__item",v.tabItem,i?.className,{"tabs__item--active":s===t})}),n??t)})))}function g(e){let{lazy:t,children:n,selectedValue:r}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function b(e){const t=h(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",v.tabList)},a.createElement(y,(0,r.Z)({},e,t)),a.createElement(g,(0,r.Z)({},e,t)))}function w(e){const t=(0,k.Z)();return a.createElement(b,(0,r.Z)({key:String(t)},e))}},59145:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>f,frontMatter:()=>s,metadata:()=>u,toc:()=>p});var r=n(87462),a=(n(67294),n(3905)),o=n(73992),i=n(18679);const s={sidebar_label:"\u9759\u6001\u7ad9\u70b9\u751f\u6210",description:"Docusaurus\u9759\u6001\u5730\u5c06\u4f60\u7684React\u4ee3\u7801\u6e32\u67d3\u6210HTML\uff0c\u5141\u8bb8\u66f4\u5feb\u7684\u52a0\u8f7d\u901f\u5ea6\u548c\u66f4\u597d\u7684SEO\u3002"},l="\u9759\u6001\u7ad9\u70b9\u751f\u6210 (SSG)",u={unversionedId:"advanced/ssg",id:"advanced/ssg",title:"\u9759\u6001\u7ad9\u70b9\u751f\u6210 (SSG)",description:"Docusaurus\u9759\u6001\u5730\u5c06\u4f60\u7684React\u4ee3\u7801\u6e32\u67d3\u6210HTML\uff0c\u5141\u8bb8\u66f4\u5feb\u7684\u52a0\u8f7d\u901f\u5ea6\u548c\u66f4\u597d\u7684SEO\u3002",source:"@site/docs/advanced/ssg.mdx",sourceDirName:"advanced",slug:"/advanced/ssg",permalink:"/docs/advanced/ssg",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/advanced/ssg.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"\u9759\u6001\u7ad9\u70b9\u751f\u6210",description:"Docusaurus\u9759\u6001\u5730\u5c06\u4f60\u7684React\u4ee3\u7801\u6e32\u67d3\u6210HTML\uff0c\u5141\u8bb8\u66f4\u5feb\u7684\u52a0\u8f7d\u901f\u5ea6\u548c\u66f4\u597d\u7684SEO\u3002"},sidebar:"docs",previous:{title:"\u8def\u7531",permalink:"/docs/advanced/routing"},next:{title:"\u5ba2\u6237\u7aef\u67b6\u6784",permalink:"/docs/advanced/client"}},c={},p=[{value:"\u7406\u89e3 SSR",id:"understanding-ssr",level:2},{value:"\u9003\u907f\u7684\u9000\u8def",id:"escape-hatches",level:2},{value:"<code>&lt;BrowserOnly&gt;</code>",id:"browseronly",level:3},{value:"<code>useIsBrowser</code>",id:"useisbrowser",level:3},{value:"<code>useEffect</code>",id:"useeffect",level:3},{value:"<code>ExecutionEnvironment</code>",id:"executionenvironment",level:3}],d={toc:p},m="wrapper";function f(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u9759\u6001\u7ad9\u70b9\u751f\u6210-ssg"},"\u9759\u6001\u7ad9\u70b9\u751f\u6210 (SSG)"),(0,a.kt)("p",null,"\u5728",(0,a.kt)("a",{parentName:"p",href:"/docs/advanced/architecture"},"\u4f53\u7cfb\u7ed3\u6784"),"\u4e2d\uff0c\u6211\u4eec\u63d0\u5230\u4e3b\u9898\u662f\u5728 Webpack \u4e2d\u8fd0\u884c\u7684\u3002\n\u4f46\u8981\u6ce8\u610f:\u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u5b83\u603b\u662f\u53ef\u4ee5\u8bbf\u95ee\u6d4f\u89c8\u5668\u5168\u5c40\u53d8\u91cf!\u4e3b\u9898\u6784\u5efa\u4e86\u4e24\u6b21:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5728\u670d\u52a1\u5668\u7aef\u6e32\u67d3\u671f\u95f4\uff0c\u4e3b\u9898\u5728\u4e00\u4e2a\u540d\u4e3a",(0,a.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/react-dom-server.html"},"React DOM Server"),"\u7684\u6c99\u76d2\u4e2d\u7f16\u8bd1\u3002\n\u4f60\u53ef\u4ee5\u628a\u5b83\u770b\u4f5c\u662f\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"li"},"\u65e0\u5934\u6d4f\u89c8\u5668"),"\uff0c\u5176\u4e2d\u6ca1\u6709",(0,a.kt)("inlineCode",{parentName:"li"},"window")," \u6216 ",(0,a.kt)("inlineCode",{parentName:"li"},"document"),"\uff0c\u53ea\u6709 React\u3002SSR \u751f\u6210\u9759\u6001 HTML \u9875\u9762\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5728",(0,a.kt)("strong",{parentName:"li"},"\u5ba2\u6237\u7aef\u5448\u73b0"),"\u671f\u95f4\uff0c\u4e3b\u9898\u88ab\u7f16\u8bd1\u6210\u6700\u7ec8\u5728\u6d4f\u89c8\u5668\u4e2d\u6267\u884c\u7684 JavaScript\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u8bbf\u95ee\u6d4f\u89c8\u5668\u53d8\u91cf\u3002")),(0,a.kt)("admonition",{title:"SSR or SSG?",type:"info"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("em",{parentName:"p"},"\u670d\u52a1\u5668\u7aef\u6e32\u67d3"),"\u548c",(0,a.kt)("em",{parentName:"p"},"\u9759\u6001\u7ad9\u70b9\u751f\u6210"),"\u53ef\u4ee5\u662f\u4e0d\u540c\u7684\u6982\u5ff5\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u4e92\u6362\u4f7f\u7528\u5b83\u4eec\u3002"),(0,a.kt)("p",{parentName:"admonition"},"\u4e25\u683c\u5730\u8bf4\uff0cDocusaurus \u662f\u4e00\u4e2a\u9759\u6001\u7ad9\u70b9\u751f\u6210\u5668\uff0c\u56e0\u4e3a\u6ca1\u6709\u670d\u52a1\u5668\u7aef\u8fd0\u884c\u65f6\u2014\u6211\u4eec\u9759\u6001\u5730\u5448\u73b0\u5230\u90e8\u7f72\u5728 CDN \u4e0a\u7684 HTML \u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e0a\u52a8\u6001\u5730\u9884\u5448\u73b0\u3002\u8fd9\u4e0e",(0,a.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next.js"),"\u7684\u5de5\u4f5c\u6a21\u578b\u4e0d\u540c\u3002")),(0,a.kt)("p",null,"\u56e0\u6b64\uff0c\u867d\u7136\u4f60\u53ef\u80fd\u77e5\u9053\u4e0d\u80fd\u8bbf\u95ee Node \u5168\u5c40\u53d8\u91cf\uff0c\u6bd4\u5982",(0,a.kt)("inlineCode",{parentName:"p"},"process"),"(\u6216\u8005\u53ef\u4ee5\u5417?)(#node-env))\u6216",(0,a.kt)("inlineCode",{parentName:"p"},"'fs'"),"\u6a21\u5757\uff0c\u4f46\u4f60\u4e5f\u4e0d\u80fd\u81ea\u7531\u8bbf\u95ee\u6d4f\u89c8\u5668\u5168\u5c40\u53d8\u91cf\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'import React from "react";\n\nexport default function WhereAmI() {\n  return <span>{window.location.href}</span>;\n}\n')),(0,a.kt)("p",null,"\u8fd9\u770b\u8d77\u6765\u50cf\u4e60\u60ef\u7684 React\uff0c\u4f46\u5982\u679c\u4f60\u8fd0\u884c",(0,a.kt)("inlineCode",{parentName:"p"},"docusaurus build"),"\uff0c\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a\u9519\u8bef:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ReferenceError: window is not defined\n")),(0,a.kt)("p",null,"\u8fd9\u662f\u56e0\u4e3a\u5728\u670d\u52a1\u5668\u7aef\u6e32\u67d3\u671f\u95f4\uff0cDocusaurus \u5e94\u7528\u7a0b\u5e8f\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u5728\u6d4f\u89c8\u5668\u4e2d\u8fd0\u884c\u7684\uff0c\u800c\u4e14\u5b83\u4e0d\u77e5\u9053\u4ec0\u4e48\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"window"),"\u3002"),(0,a.kt)("details",{id:"node-env"},(0,a.kt)("summary",null,"What about ",(0,a.kt)("code",null,"process.env.NODE_ENV"),"?"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u65e0\u8282\u70b9\u5168\u5c40\u53d8\u91cf"),"\u89c4\u5219\u7684\u4e00\u4e2a\u4f8b\u5916\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV"),"\u3002\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u53ef\u4ee5\u5728 React \u4e2d\u4f7f\u7528\u5b83\uff0c\u56e0\u4e3a Webpack \u5c06\u8fd9\u4e2a\u53d8\u91cf\u4f5c\u4e3a\u5168\u5c40\u53d8\u91cf\u6ce8\u5165:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'import React from "react";\n\nexport default function expensiveComp() {\n  if (process.env.NODE_ENV === "development") {\n    return <>This component is not shown in development</>;\n  }\n  const res = someExpensiveOperationThatLastsALongTime();\n  return <>{res}</>;\n}\n')),(0,a.kt)("p",null,"\u5728 Webpack \u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV"),"\u5c06\u88ab\u66ff\u6362\u4e3a",(0,a.kt)("inlineCode",{parentName:"p"},"'development'")," \u6216 ",(0,a.kt)("inlineCode",{parentName:"p"},"'production'"),"\u3002\u5728\u6d88\u9664\u6b7b\u4ee3\u7801\u540e\uff0c\u60a8\u5c06\u83b7\u5f97\u4e0d\u540c\u7684\u6784\u5efa\u7ed3\u679c:"),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"Development",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"import React from 'react';\n\nexport default function expensiveComp() {\n  // highlight-next-line\n  if ('development' === 'development') {\n+   return <>This component is not shown in development</>;\n  }\n- const res = someExpensiveOperationThatLastsALongTime();\n- return <>{res}</>;\n}\n"))),(0,a.kt)(i.Z,{value:"Production",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"import React from 'react';\n\nexport default function expensiveComp() {\n  // highlight-next-line\n- if ('production' === 'development') {\n-   return <>This component is not shown in development</>;\n- }\n+ const res = someExpensiveOperationThatLastsALongTime();\n+ return <>{res}</>;\n}\n"))))),(0,a.kt)("h2",{id:"understanding-ssr"},"\u7406\u89e3 SSR"),(0,a.kt)("p",null,"React is not just a dynamic UI runtime\u2014it's also a templating engine. Because Docusaurus sites mostly contain static contents, it should be able to work without any JavaScript (which React runs in), but only plain HTML/CSS. And that's what server-side rendering offers: statically rendering your React code into HTML, without any dynamic content. An HTML file has no concept of client state (it's purely markup), hence it shouldn't rely on browser APIs."),(0,a.kt)("p",null,"These HTML files are the first to arrive at the user's browser screen when a URL is visited (see ",(0,a.kt)("a",{parentName:"p",href:"/docs/advanced/routing"},"routing"),'). Afterwards, the browser fetches and runs other JS code to provide the "dynamic" parts of your site\u2014anything implemented with JavaScript. However, before that, the main content of your page is already visible, allowing faster loading.'),(0,a.kt)("p",null,'In CSR-only apps, all DOM elements are generated on client side with React, and the HTML file only ever contains one root element for React to mount DOM to; in SSR, React is already facing a fully built HTML page, and it only needs to correlate the DOM elements with the virtual DOM in its model. This step is called "hydration". After React has hydrated the static markup, the app starts to work as any normal React app.'),(0,a.kt)("p",null,"Note that Docusaurus is ultimately a single-page application, so static site generation is only an optimization (",(0,a.kt)("em",{parentName:"p"},"progressive enhancement"),", as it's called), but our functionality does not fully depend on those HTML files. This is contrary to site generators like ",(0,a.kt)("a",{parentName:"p",href:"https://jekyllrb.com/"},"Jekyll")," and ",(0,a.kt)("a",{parentName:"p",href:"https://v1.docusaurus.io/"},"Docusaurus v1"),", where all files are statically transformed to markup, and interactiveness is added through external JavaScript linked with ",(0,a.kt)("inlineCode",{parentName:"p"},"<script>")," tags. If you inspect the build output, you will still see JS assets under ",(0,a.kt)("inlineCode",{parentName:"p"},"build/assets/js"),", which are, really, the core of Docusaurus."),(0,a.kt)("h2",{id:"escape-hatches"},"\u9003\u907f\u7684\u9000\u8def"),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u60f3\u5728\u5c4f\u5e55\u4e0a\u5448\u73b0\u4efb\u4f55\u4f9d\u8d56\u4e8e\u6d4f\u89c8\u5668 API \u7684\u52a8\u6001\u5185\u5bb9\uff0c\u4f8b\u5982:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6211\u4eec\u7684",(0,a.kt)("a",{parentName:"li",href:"/docs/markdown-features/code-blocks#interactive-code-editor"},"live codeblock"),"\uff0c\u5b83\u8fd0\u884c\u5728\u6d4f\u89c8\u5668\u7684 JS \u8fd0\u884c\u65f6\u4e2d"),(0,a.kt)("li",{parentName:"ul"},"\u6211\u4eec\u7684","[\u4e3b\u9898\u56fe\u50cf]","(/docs/markdown-features/assets#theme -images)\u68c0\u6d4b\u7528\u6237\u7684\u914d\u8272\u65b9\u6848\u4ee5\u663e\u793a\u4e0d\u540c\u7684\u56fe\u50cf"),(0,a.kt)("li",{parentName:"ul"},"\u8c03\u8bd5\u9762\u677f\u7684 JSON \u67e5\u770b\u5668\uff0c\u5b83\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"li"},"window"),"\u5168\u5c40\u6837\u5f0f")),(0,a.kt)("p",null,"\u60a8\u53ef\u80fd\u9700\u8981\u907f\u5f00 SSR\uff0c\u56e0\u4e3a\u9759\u6001 HTML \u5728\u4e0d\u77e5\u9053\u5ba2\u6237\u7aef\u72b6\u6001\u7684\u60c5\u51b5\u4e0b\u65e0\u6cd5\u663e\u793a\u4efb\u4f55\u6709\u7528\u7684\u5185\u5bb9\u3002"),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"It is important for the first client-side render to produce the exact same DOM structure as server-side rendering, otherwise, React will correlate virtual DOM with the wrong DOM elements."),(0,a.kt)("p",{parentName:"admonition"},"Therefore, the na\xefve attempt of ",(0,a.kt)("inlineCode",{parentName:"p"},"if (typeof window !== 'undefined) {/* render something */}")," won't work appropriately as a browser vs. server detection, because the first client render would instantly render different markup from the server-generated one."),(0,a.kt)("p",{parentName:"admonition"},"You can read more about this pitfall in ",(0,a.kt)("a",{parentName:"p",href:"https://www.joshwcomeau.com/react/the-perils-of-rehydration/"},"The Perils of Rehydration"),".")),(0,a.kt)("p",null,"We provide several more reliable ways to escape SSR."),(0,a.kt)("h3",{id:"browseronly"},(0,a.kt)("inlineCode",{parentName:"h3"},"<BrowserOnly>")),(0,a.kt)("p",null,"If you need to render some component in browser only (for example, because the component relies on browser specifics to be functional at all), one common approach is to wrap your component with ",(0,a.kt)("a",{parentName:"p",href:"/docs/docusaurus-core#browseronly"},(0,a.kt)("inlineCode",{parentName:"a"},"<BrowserOnly>"))," to make sure it's invisible during SSR and only rendered in CSR."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'import BrowserOnly from "@docusaurus/BrowserOnly";\n\nfunction MyComponent(props) {\n  return (\n    // highlight-start\n    <BrowserOnly fallback={<div>Loading...</div>}>\n      {() => {\n        const LibComponent = require("some-lib-that-accesses-window").LibComponent;\n        return <LibComponent {...props} />;\n      }}\n    </BrowserOnly>\n    // highlight-end\n  );\n}\n')),(0,a.kt)("p",null,"It's important to realize that the children of ",(0,a.kt)("inlineCode",{parentName:"p"},"<BrowserOnly>")," is not a JSX element, but a function that ",(0,a.kt)("em",{parentName:"p"},"returns")," an element. This is a design decision. Consider this code:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import BrowserOnly from \"@docusaurus/BrowserOnly\";\n\nfunction MyComponent() {\n  return (\n    <BrowserOnly>\n      {/* highlight-start */}\n      {/* DON'T DO THIS - doesn't actually work */}\n      <span>page url = {window.location.href}</span>\n      {/* highlight-end */}\n    </BrowserOnly>\n  );\n}\n")),(0,a.kt)("p",null,"While you may expect that ",(0,a.kt)("inlineCode",{parentName:"p"},"BrowserOnly")," hides away the children during server-side rendering, it actually can't. When the React renderer tries to render this JSX tree, it does see the ",(0,a.kt)("inlineCode",{parentName:"p"},"{window.location.href}")," variable as a node of this tree and tries to render it, although it's actually not used! Using a function ensures that we only let the renderer see the browser-only component when it's needed."),(0,a.kt)("h3",{id:"useisbrowser"},(0,a.kt)("inlineCode",{parentName:"h3"},"useIsBrowser")),(0,a.kt)("p",null,"You can also use the ",(0,a.kt)("inlineCode",{parentName:"p"},"useIsBrowser()")," hook to test if the component is currently in a browser environment. It returns ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," in SSR and ",(0,a.kt)("inlineCode",{parentName:"p"},"true")," is CSR, after first client render. Use this hook if you only need to perform certain conditional operations on client-side, but not render an entirely different UI."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'import useIsBrowser from "@docusaurus/useIsBrowser";\n\nfunction MyComponent() {\n  const isBrowser = useIsBrowser();\n  const location = isBrowser ? window.location.href : "fetching location...";\n  return <span>{location}</span>;\n}\n')),(0,a.kt)("h3",{id:"useeffect"},(0,a.kt)("inlineCode",{parentName:"h3"},"useEffect")),(0,a.kt)("p",null,"Lastly, you can put your logic in ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect()")," to delay its execution until after first CSR. This is most appropriate if you are only performing side-effects but don't ",(0,a.kt)("em",{parentName:"p"},"get")," data from the client state."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'function MyComponent() {\n  useEffect(() => {\n    // Only logged in the browser console; nothing is logged during server-side rendering\n    console.log("I\'m now in the browser");\n  }, []);\n  return <span>Some content...</span>;\n}\n')),(0,a.kt)("h3",{id:"executionenvironment"},(0,a.kt)("inlineCode",{parentName:"h3"},"ExecutionEnvironment")),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"/docs/docusaurus-core#executionenvironment"},(0,a.kt)("inlineCode",{parentName:"a"},"ExecutionEnvironment"))," namespace contains several values, and ",(0,a.kt)("inlineCode",{parentName:"p"},"canUseDOM")," is an effective way to detect browser environment."),(0,a.kt)("p",null,"Beware that it essentially checked ",(0,a.kt)("inlineCode",{parentName:"p"},"typeof window !== 'undefined'")," under the hood, so you should not use it for rendering-related logic, but only imperative code, like reacting to user input by sending web requests, or dynamically importing libraries, where DOM isn't updated at all."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="a-client-module.js"',title:'"a-client-module.js"'},'import ExecutionEnvironment from "@docusaurus/ExecutionEnvironment";\n\nif (ExecutionEnvironment.canUseDOM) {\n  document.title = "I\'m loaded!";\n}\n')))}f.isMDXComponent=!0}}]);